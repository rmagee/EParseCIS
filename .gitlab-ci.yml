stages:
    - test-python
    - build-docs

before_script:
  - bash
  # install ssh-agent
  - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'
  - 'which bash || ( apt-get update -y && apt-get install bash -y )'
  - apt-get update -y && apt-get install git python-psycopg2 -y
  # run ssh-agent
  - eval $(ssh-agent -s)
  # add ssh key stored in SSH_PRIVATE_KEY variable to the agent store
  # if you are running your tests locally you can set this variable
  # by executing export SERIALBOX_SSH_KEY=$(cat ~/.ssh/[your private key file here])
  # to create the environment variable
  # disable host key checking (NOTE: makes you susceptible to man-in-the-middle attacks)
  # WARNING: use only in docker container, if you use it with shell you will overwrite your user's ssh config
  - mkdir -p ~/.ssh
  - ssh-add <(echo "$SERIALBOX_SSH_KEY")
  - echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config

python3_5_unit_test:
  image: seriallab/python3.5dev
  stage: test-python
  script:
  - export PYTHONPATH=$PYTHONPATH:$CI_PROJECT_DIR
  - apt-get install git-all
  - pip install tox
  - tox
  artifacts:
    paths:
      - htmlcov/

pages:
    image: seriallab/python3.5dev
    stage: build-docs
    script:
    - export PYTHONPATH=$PYTHONPATH:$CI_PROJECT_DIR
    - pip install sphinx sphinx_rtd_theme pygments ipython
    - make docs
    - mv docs/_build/html/ public/
    artifacts:
        paths:
        - public
    only:
      - master


